<template name="App_newProduct">

  <div class="content mt-3">
    <div class="animated fadeIn">
      <div class="row">
        <div class="col-lg-12">
          <div class="card">

            <div class="card-header">
              Please fill in information for new product
              <!-- <small> <code>.col-lg-*</code><code>.col-md-*</code><code>.col-sm-*</code> </small> -->
            </div>

            <div class="card-body card-block">
              <form action="" id="newProductForm" method="post" class="form-horizontal">
                <div class="row">
                  <!-- image column -->
                  <div class="col col-md-3">
                    {{#if currentProductImage}}
                    <!-- from helpers in package cfs:ui-->
                      {{#unless this.isUploaded}}
                        {{> FS.UploadProgressBar bootstrap=true class='progress-bar-success  active' showPercent=true}}
                      {{/unless}}
                      <!-- if there is a selected image, the image show -->
                      <img id="imageDisplay" src="{{currentProductImage.url store='images'}}" alt="" style="width: 730px;">
                    {{else}}
                      <!-- default gray picture -->
                      <img id="imageDisplay" src="/images/item-14.jpg" alt="" style="width: 730px;">
                    {{/if}}
                    <!-- Upload button  -->
                    <label for="upload">
                      <a class="btn btn-primary">Upload</a>
                      <input type="file" id="upload" style="display:none">
                      <!-- event handler listen to this input change in newProduct.js -->
                    </label>

                    <button type="button" id="selectImageBtn" class="btn btn-secondary mb-1">
                      Select Image
                    </button>
                  </div>

                  <!-- Form column -->
                  <div class="col col-md-7">
                    <div class="row form-group">
                      <div class="col col-md-6">
                        <label for="englishName" class=" form-control-label">English Name</label>
                        <input type="text" id="englishName" placeholder="Apples" class="form-control" required="required">
                      </div>
                      <div class="col col-md-6">
                        <label for="khmerName" class=" form-control-label">Khmer Name</label>
                        <input type="text" id="khmerName" placeholder="ផ្លែប៉ោម" class="form-control" required="required">
                      </div>
                    </div>
                    <div class="row form-group">
                      <div class="col col-md-3">
                        <label for="regularPrice" class=" form-control-label">Regular Price</label>
                        <input type="number" id="regularPrice" min="0.01" step="0.01" placeholder="$" class="form-control">
                      </div>
                      <div class="col col-md-3">
                        <label for="salePrice" class=" form-control-label">Sale Price</label>
                        <input type="number" id="salePrice" min="0.01" step="0.01" placeholder="$" class="form-control" required="required">
                        <small id="emailHelp" class="form-text text-muted">Customer pay this price</small>
                      </div>
                      <div class="col col-md-2">
                        <label for="unit" class=" form-control-label">Unit</label>
                        <input type="text" id="unit" placeholder="kg/gram" class="form-control" required="required">
                      </div>

                    </div>
                    <div class="row form-group">

                      <div class="col col-md-3">
                        <label for="min" class=" form-control-label">Min</label>
                        <input type="number" id="min" min="0.01" step="0.01" placeholder="Min unit" class="form-control">
                      </div>
                      <div class="col col-md-3">
                        <label for="step" class=" form-control-label">Step</label>
                        <input type="number" id="step" step="0.01" min="0.01" max="1" placeholder="0.01" class="form-control">
                      </div>
                      <div class="col col-md-6">
                        <label for="purchaseNote" class=" form-control-label">Purchase Note</label>
                        <input type="text" id="purchaseNote" placeholder="" class="form-control">
                      </div>
                    </div>
                    <div class="row form-group">

                      <div class="col col-md-12">
                        <label for="description" class=" form-control-label">Description</label>
                        <textarea name="description" id="description" rows="3" placeholder="Like... vitamin...fat...calory" class="form-control"></textarea>
                      </div>
                    </div>
                    <div class="row form-group">
                      <div class="col-12 col-md-3 offset-md-1 form-check">
                        <div class="checkbox">
                          <label for="featured" class="form-check-label ">
                            <input type="checkbox" id="featured" name="featured" class="form-check-input">Featured
                          </label>
                        </div>
                      </div>
                      <div class="col-12 col-md-3 form-check">
                        <div class="checkbox">
                          <label for="instock" class="form-check-label">
                            <input type="checkbox" id="instock" name="instock" checked="checked" class="form-check-input">In stock
                          </label>
                        </div>
                      </div>
                    </div>
                  </div>
                  <!-- Categories checkbox column -->
                  <div class="col-md-2">
                    <div class="row form-group">
                      <label>Categories</label>
                      <div class="col col-md-12">
                        <div class="form-check">

                          {{> checkboxCategories categoriesList}}

                        </div>
                      </div>
                    </div>
                  </div>

                </div>

                <!-- submit button -->
                <div class="row">
                  <div class="col-md-3">
                    {{#if isEditMode}}
                      <button type="submit" class="at-btn flex-c-m size2 bg1 bo-rad-23 hov1 m-text3 trans-0-4 submit ">Update</button>
                    {{else}}
                      <button type="submit" class="at-btn flex-c-m size2 bg1 bo-rad-23 hov1 m-text3 trans-0-4 submit ">Create</button>
                    {{/if}}
                  </div>
                </div>

              </form>
            </div>
            <!-- card body -->
          </div>
          <!-- card -->
        </div>
        <!-- col-lg-12 -->
      </div>
      <!-- row -->
    </div>
    <!-- .animated -->
  </div>
  <!-- .content -->

  <script src="/assets/js/vendor/jquery-2.1.4.min.js"></script>
  <script src="/assets/js/popper.min.js"></script>
  <script src="/assets/js/plugins.js"></script>
  <script src="/assets/js/main.js"></script>
</template>

<!-- modal popup when selected image button clicked -->
<template name="selectImageModal">
  <div class="modal fade" id="selectImageModal" tabindex="-1" role="dialog" aria-labelledby="largeModalLabel" aria-hidden="true">
    <div class="modal-dialog modal-lg" role="document">
      <div class="modal-content">
        <div class="modal-header">
          <h5 class="modal-title" id="largeModalLabel">Select an image</h5>
          <button type="button" class="close" data-dismiss="modal" aria-label="Close">
            <span aria-hidden="true">&times;</span>
          </button>
        </div>
        <div class="modal-body">
          <div class="row">
            {{#each images}}
              <div class="col-md-3">
                {{> FS.DeleteButton class="btn btn-danger btn-xs"}}
                <a href="#" class="productImage">
                  <!-- display only thumbnail image -->
                  <!-- original image, change store='images' -->
                  <!-- when image clicked the modal close -->
                  <img src="{{this.url store='thumb'}}" alt="{{this.name}}">
                </a>
              </div>
            {{/each}}
          </div>

        </div>
        <div class="modal-footer">
          <button type="button" class="btn btn-secondary" data-dismiss="modal">Cancel</button>
          <button type="button" class="btn btn-primary">Confirm</button>
        </div>
      </div>
    </div>
  </div>
</template>

<!-- we don't know how many subcategory there are in categoreis, so we do recursion with templates -->
<template name="checkboxCategories">
  {{#each this}}
    <div class="checkbox">
      <label for="{{this.slug}}" class="form-check-label ">
        <input type="checkbox" name="categories" id="{{this.slug}}" value="{{this.slug}}" class="form-check-input">{{this.name}}
        {{#if this.subcategory}}
          {{> checkboxCategories this.subcategory}}
          <!-- calling its template -->
        {{/if}}
      </label>
    </div>
  {{/each}}
</template>
